@model PainelAdmin.Models.ViewModels.EditarUsuarioViewModel
@{
    ViewData["Title"] = "Editar Usuário";
}

<head>
    <link rel="stylesheet" href="~/css/modal-confirmacao.css" />
</head>

<h2 class="titulo-usuario">@ViewData["Title"]</h2>

<a asp-action="Index" class="text-success voltar" style="float: right; text-decoration: none;">← Voltar</a>

<form asp-action="Editar" method="post" enctype="multipart/form-data" id="form-editar">
    <input type="hidden" asp-for="Id" />
    <input type="hidden" asp-for="Foto" />

    <div class="form-row">
        <div class="form-group form-col">
            <label asp-for="Nome" class="label-custom"></label>
            <input asp-for="Nome" class="form-control campo-tamanho" />
            <span asp-validation-for="Nome" class="text-danger"></span>
        </div>

        <div class="form-group form-col">
            <label asp-for="Email" class="label-custom"></label>
            <input asp-for="Email" class="form-control campo-tamanho" />
            <span asp-validation-for="Email" class="text-danger"></span>
        </div>
    </div>

    <div class="form-row">
        <div class="form-group form-col">
            <label asp-for="CPF" class="label-custom"></label>
            <input asp-for="CPF" class="form-control campo-tamanho" />
            <span asp-validation-for="CPF" class="text-danger"></span>
        </div>

        <div class="form-group form-col">
            <label asp-for="Telefone" class="label-custom"></label>
            <input asp-for="Telefone" class="form-control campo-tamanho" />
            <span asp-validation-for="Telefone" class="text-danger"></span>
        </div>
    </div>

    <div class="form-group form-col">
        <label asp-for="DataNascimento" class="label-custom"></label>
        <input asp-for="DataNascimento" type="date" class="form-control campo-tamanho" />
        <span asp-validation-for="DataNascimento" class="text-danger"></span>
    </div>

    @if (!string.IsNullOrEmpty(Model.Foto))
    {
        <div class="form-group form-col">
            <label class="label-custom">Foto Atual:</label><br />
            <img src="~/@Model.Foto" alt="Foto do usuário" style="width: 120px; border-radius: 8px; border: 1px solid #ccc;" />
        </div>
    }

    <div class="form-group form-col">
        <label class="label-custom">Nova Foto</label>
        <input type="file" name="NovaFoto" class="form-control campo-tamanho" />
    </div>

    <h4 class="titulo-endereco">Endereço</h4>

    <div class="form-row">
        <div class="form-group form-col">
            <label asp-for="Rua" class="label-custom"></label>
            <input asp-for="Rua" class="form-control campo-tamanho" />
        </div>

        <div class="form-group form-col">
            <label asp-for="Numero" class="label-custom"></label>
            <input asp-for="Numero" class="form-control campo-numero" />
        </div>
    </div>

    <div class="form-row">
        <div class="form-group form-col" style="flex: 1 1 100%;">
            <label asp-for="Complemento" class="label-custom"></label>
            <input asp-for="Complemento" class="form-control campo-tamanho" />
        </div>
    </div>

    <div class="form-row">
        <div class="form-group form-col">
            <label asp-for="Bairro" class="label-custom"></label>
            <input asp-for="Bairro" class="form-control campo-tamanho" />
        </div>

        <div class="form-group form-col">
            <label asp-for="Cidade" class="label-custom"></label>
            <input asp-for="Cidade" class="form-control campo-tamanho" />
        </div>

        <div class="form-group form-col">
            <label asp-for="Estado" class="label-custom"></label>
            <input asp-for="Estado" class="form-control campo-tamanho" />
        </div>

        <div class="form-group form-col">
            <label asp-for="CEP" class="label-custom"></label>
            <input asp-for="CEP" class="form-control campo-tamanho" />
        </div>
    </div>

    <div class="form-group form-col">
        <label asp-for="NovaRole" class="label-custom">Perfil</label>
        <select asp-for="NovaRole" asp-items="@(new SelectList(Model.RolesDisponiveis))" class="form-control campo-tamanho"></select>
        <span asp-validation-for="NovaRole" class="text-danger"></span>
    </div>

    <div class="form-check mt-2 mb-3">
        <input asp-for="Ativo" class="form-check-input" />
        <label asp-for="Ativo" class="form-check-label label-custom"></label>
    </div>

    <button type="button" class="btn btn-primary" onclick="abrirModal()">Salvar</button>
</form>

<!-- Modal de Confirmação -->
<div id="modalConfirmacao" class="modal-custom">
    <div class="modal-content-custom">
        <p class="texto-modal">Tem certeza que deseja salvar as alterações?</p>
        <div class="botoes-modal">
            <button class="btn-cancelar" onclick="fecharModal()">Não</button>
            <button class="btn-confirmar" onclick="enviarFormulario()">Sim</button>
        </div>
    </div>
</div>

@section Scripts {
    @Html.Partial("_ValidationScriptsPartial")

    <script>
        function abrirModal() {
            document.getElementById("modalConfirmacao").style.display = "flex";
        }

        function fecharModal() {
            document.getElementById("modalConfirmacao").style.display = "none";
        }

        function enviarFormulario() {
            const confirmarBtn = document.querySelector('.btn-confirmar');
            confirmarBtn.disabled = true;
            confirmarBtn.textContent = 'Salvando...';
            document.getElementById("form-editar").submit();
        }
    </script>
}
