@model PainelAdmin.Models.ViewModels.EditarUsuarioViewModel

@{
    ViewData["Title"] = "Editar Usuário";
    Layout = "_Painel";
}

<div class="container mt-4">
    <h2 class="mb-4">Editar Usuário</h2>

    <form asp-action="Editar" method="post" enctype="multipart/form-data">
        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="Foto" />

        <div class="row g-3">
            <!-- Dados básicos -->
            <div class="col-md-6">
                <label asp-for="Nome" class="form-label"></label>
                <input asp-for="Nome" class="form-control" />
                <span asp-validation-for="Nome" class="text-danger small"></span>
            </div>

            <div class="col-md-6">
                <label asp-for="Email" class="form-label"></label>
                <input asp-for="Email" class="form-control" />
                <span asp-validation-for="Email" class="text-danger small"></span>
            </div>

            <div class="col-md-6">
                <label asp-for="CPF" class="form-label"></label>
                <input asp-for="CPF" class="form-control" />
                <span asp-validation-for="CPF" class="text-danger small"></span>
            </div>

            <div class="col-md-6">
                <label asp-for="Telefone" class="form-label"></label>
                <input asp-for="Telefone" class="form-control" />
                <span asp-validation-for="Telefone" class="text-danger small"></span>
            </div>

            <div class="col-md-6">
                <label asp-for="DataNascimento" class="form-label"></label>
                <input asp-for="DataNascimento" type="date" class="form-control" />
                <span asp-validation-for="DataNascimento" class="text-danger small"></span>
            </div>

           <!-- <div class="col-md-6">
                <label asp-for="SenhaAtual" class="form-label"></label>
                <input asp-for="SenhaAtual" class="form-control" type="password" />
                <span asp-validation-for="SenhaAtual" class="text-danger small"></span>
             </div>-->

      


            <!-- Foto atual -->
            @if (!string.IsNullOrEmpty(Model.Foto))
            {
                <div class="col-12">
                    <label class="form-label">Foto atual:</label><br />
                    <img src="@Model.Foto" alt="Foto atual" class="img-thumbnail rounded" style="width: 120px;" />
                </div>
            }

            <!-- Upload de nova foto + preview -->
            <div class="col-md-6">
                <label class="form-label">Nova Foto</label>
                <input type="file" name="NovaFoto" class="form-control" accept="image/*" onchange="previewNovaFoto(event)" />
            </div>
            <div class="col-md-6">
                <label class="form-label">Pré-visualização</label><br />
                <img id="previewImagem" class="img-thumbnail rounded" style="width: 120px; display: none;" />
            </div>

            <hr class="mt-4" />
            <h5 class="mt-4">Endereço</h5>

            <div class="col-md-6">
                <label asp-for="Rua" class="form-label"></label>
                <input asp-for="Rua" class="form-control" />
            </div>

            <div class="col-md-3">
                <label asp-for="Numero" class="form-label"></label>
                <input asp-for="Numero" class="form-control" />
            </div>

            <div class="col-md-3">
                <label asp-for="Complemento" class="form-label"></label>
                <input asp-for="Complemento" class="form-control" />
            </div>

            <div class="col-md-6">
                <label asp-for="Bairro" class="form-label"></label>
                <input asp-for="Bairro" class="form-control" />
            </div>

            <div class="col-md-4">
                <label asp-for="Cidade" class="form-label"></label>
                <input asp-for="Cidade" class="form-control" />
            </div>

            <div class="col-md-2">
                <label asp-for="Estado" class="form-label"></label>
                <input asp-for="Estado" class="form-control" />
            </div>

            <div class="col-md-4">
                <label asp-for="CEP" class="form-label"></label>
                <input asp-for="CEP" class="form-control" />
            </div>

            <div class="col-md-4">
                <label asp-for="NovaRole" class="form-label">Função</label>
                <select asp-for="NovaRole" asp-items="@(new SelectList(Model.RolesDisponiveis))" class="form-select"></select>
                <span asp-validation-for="NovaRole" class="text-danger small"></span>
            </div>

            <div class="col-md-4 d-flex align-items-center">
                <div class="form-check mt-3">
                    <input asp-for="Ativo" class="form-check-input" />
                    <label asp-for="Ativo" class="form-check-label"></label>
                </div>
            </div>

            <div class="col-12 mt-4">
                <button type="submit" class="btn btn-success">Salvar</button>
                <a asp-action="Index" class="btn btn-secondary ms-2">Cancelar</a>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
    <script>
        function previewNovaFoto(event) {
            const preview = document.getElementById('previewImagem');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
        }
    </script>
}
