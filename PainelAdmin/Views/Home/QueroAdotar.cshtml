@model IEnumerable<PainelAdmin.Models.Pet>

@{
    ViewData["Title"] = "Quero Adotar";
}

@section Styles {
    <link rel="stylesheet" href="~/css/site/style-adotar.css" asp-append-version="true" />
}

<div class="container infos">
    <h2>Adote um amigo!</h2>
    <h6>Aqui você encontra todos os anjinhos que estão procurando uma família amorosa.</h6>
</div>

<div class="container c-body">
    <div class="accordion accordion-flush accordion-size overflow-hidden" id="accordionFlushExample">

        <!-- Título fixo -->
        <div class="accordion-item">
            <h2 class="accordion-header filtro">Filtros</h2>
        </div>

        <!-- Espécie -->
        <div class="checkbox-group">
            <div class="checkbox checked">
                <input id="especie-gato" name="especie" type="checkbox" value="Gato" />
                <label for="especie-gato" class="checkbox-label">Gato</label>
            </div>
            <div class="checkbox">
                <input id="especie-cachorro" name="especie" type="checkbox" value="Cachorro" />
                <label for="especie-cachorro" class="checkbox-label">Cachorro</label>
            </div>
        </div>

        <!-- Idade (esses valores permanecem em minúsculo pois no backend você interpreta "filhote", "adulto", "idoso") -->
        <div class="checkbox-group">
            <div class="checkbox checked">
                <input id="idade-filhote" name="idade" type="checkbox" value="filhote" />
                <label for="idade-filhote" class="checkbox-label">Filhote</label>
            </div>
            <div class="checkbox">
                <input id="idade-adulto" name="idade" type="checkbox" value="adulto" />
                <label for="idade-adulto" class="checkbox-label">Adulto</label>
            </div>
            <div class="checkbox">
                <input id="idade-idoso" name="idade" type="checkbox" value="idoso" />
                <label for="idade-idoso" class="checkbox-label">Idoso</label>
            </div>
        </div>

        <!-- Porte -->
        <div class="checkbox-group">
            <div class="checkbox checked">
                <input id="porte-pequeno" name="porte" type="checkbox" value="Pequeno" />
                <label for="porte-pequeno" class="checkbox-label">Pequeno</label>
            </div>
            <div class="checkbox">
                <input id="porte-medio" name="porte" type="checkbox" value="Medio" />
                <label for="porte-medio" class="checkbox-label">Médio</label>
            </div>
            <div class="checkbox">
                <input id="porte-grande" name="porte" type="checkbox" value="Grande" />
                <label for="porte-grande" class="checkbox-label">Grande</label>
            </div>
        </div>

        <!-- Sexo -->
        <div class="radio-group">
            <div class="radio checked">
                <input id="sexo-macho" name="sexo" type="checkbox" value="Macho" />
                <label for="sexo-macho" class="checkbox-label">Macho</label>
            </div>
            <div class="radio">
                <input id="sexo-femea" name="sexo" type="checkbox" value="Femea" />
                <label for="sexo-femea" class="checkbox-label">Fêmea</label>
            </div>
        </div>


    </div>

    <!-- Cards de animais -->
    <div class="container animals">
        <div class="titulo">
            <h2>Pets disponíveis</h2>
        </div>
        <div class="container fotos">
            @foreach (var animal in Model)
            {
                <div class="card card-cc" style="width: 18rem;">
                    <img src="~/@animal.Foto" class="card-img-top" alt="Foto do pet" />
                    <div class="card-body card-animais">
                        <h5 class="card-title">@animal.Nome</h5>
                        <a href="#" class="btn btn-success">Adotar</a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    function coletarFiltros(nome) {
        let valores = [];
        $('input[name="' + nome + '"]:checked').each(function () {
            valores.push($(this).val());
        });
        return valores;
    }

    function aplicarFiltros() {
        let filtros = {
            especie: coletarFiltros('especie'),
            idade: coletarFiltros('idade'),
            porte: coletarFiltros('porte'),
            sexo: coletarFiltros('sexo')
        };

        $.ajax({
            type: 'POST',
            url: '/Home/Filtrar',
            contentType: 'application/json',
            data: JSON.stringify(filtros),
            success: function (html) {
                $('.fotos').html(html);
            }
        });
    }

    $(document).ready(function () {
        $('input[type="checkbox"]').change(function () {
            aplicarFiltros();
        });
    });

    $(document).ready(function () {
        // Fechar os outros ao abrir um
        $('.accordion-button').on('click', function () {
            var target = $(this).data('bs-target');

            // Se o alvo já está aberto, não faz nada (o Bootstrap cuida de fechar)
            if (!$(target).hasClass('show')) {
                $('.accordion-collapse.show').collapse('hide');
            }
        });
    });
</script>
